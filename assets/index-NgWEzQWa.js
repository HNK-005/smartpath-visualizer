(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class C{navContainer;navHeader;navControls;algorithmOptions=[{value:"BFS",label:"Breadth-First Search (BFS)"},{value:"DFS",label:"Depth-First Search (DFS)"},{value:"Dijkstra",label:"Dijkstra's Algorithm"},{value:"A*",label:"A* Search Algorithm"}];constructor(t){const e=document.getElementById(t);if(!e)throw new Error(`Container with id ${t} not found`);this.navContainer=e,this.navHeader=this.initHeader(),this.navControls=this.initControls()}initialize(){this.navContainer.innerHTML="",this.navContainer.appendChild(this.navHeader),this.navContainer.appendChild(this.navControls),this.render()}initHeader(){const t=document.createElement("div");return t.classList.add("nav-header"),t}initControls(){const t=document.createElement("div");return t.classList.add("nav-controls"),t}renderHeader(){this.navHeader.innerHTML='<a href="#">SmartPath Visualizer</a>'}renderControls(){this.navControls.innerHTML=`
    <div class="algorithm">
        <label for="algorithm" class="combobox-label">Algorithm:</label>
        <select>
          ${this.algorithmOptions.map(t=>`<option value="${t.value}">${t.label}</option>`).join("")}
        </select> 
    </div>
    <div class="action">
      <button class="save-file btn btn-maze">
        Export
      </button>
      <button class="open-file btn btn-maze">
        Import
      </button>
      <button class="clear-board btn btn-clear">
        Clear Board
      </button>
      <button class="clear-walls btn btn-clear">
        Clear Walls
      </button>
      <button class="clear-path btn btn-clear">
        Clear Path
      </button>
      <button class="visualize btn btn-start">
        Visualize
      </button>
    </div>
    `}render(){this.renderHeader(),this.renderControls()}getAlgorithmOptions(){return this.algorithmOptions}getAlgorithmSelectElement(){return this.navControls.querySelector(".algorithm select")}getVisualizeButton(){return this.navControls.querySelector(".visualize")}getClearWallsButton(){return this.navControls.querySelector(".clear-walls")}getClearPathButton(){return this.navControls.querySelector(".clear-path")}getClearBoardButton(){return this.navControls.querySelector(".clear-board")}getSaveFileButton(){return this.navControls.querySelector(".save-file")}getOpenFileButton(){return this.navControls.querySelector(".open-file")}}var c=(a=>(a.START="start",a.END="end",a.WALL="wall",a.VISITED="visited",a.UNVISITED="unvisited",a.SHORTEST_PATH="shortest-path",a))(c||{});class N{gridContainer;gridBoard;constructor(t){const e=document.getElementById(t);if(!e)throw new Error(`Container with id ${t} not found`);this.gridContainer=e,this.gridBoard=this.initBoard()}initialize(t){this.gridContainer.innerHTML="",this.gridContainer.appendChild(this.gridBoard),this.render(t)}initBoard(){const t=document.createElement("table");return t.classList.add("board"),t}classNode(t){const e=[];return t.getIsStart()&&e.push("start"),t.getIsEnd()&&e.push("end"),t.getIsWall()&&e.push("wall"),t.getIsVisited()?e.push("visited"):e.push("unvisited"),t.getIsPath()&&e.push("shortest-path"),e.join(" ")}renderBoard(t){const e=document.createElement("tbody");t.getNodes().forEach((s,i)=>{const n=document.createElement("tr");s.forEach((r,o)=>{const l=document.createElement("td");l.id=`${i}-${o}`,l.className=this.classNode(r),n.appendChild(l)}),e.appendChild(n)}),this.gridBoard.innerHTML="",this.gridBoard.appendChild(e)}render(t){this.renderBoard(t)}getBoardElement(){return this.gridBoard}getNodeElement(t,e){return this.gridBoard.querySelector(`td[id="${t}-${e}"]`)}updateNodeClass(t,e){t.className="",this.addNodeClass(t,e)}addNodeClass(t,e){t.classList.add(e)}removeNodeClass(t,e){t.classList.remove(e)}}class f{async saveFile(t){try{const s=await(await window.showSaveFilePicker({suggestedName:"data.json",types:[{description:"File JSON",accept:{"application/json":[".json"]}}]})).createWritable();s.write(t),await s.close()}catch(e){console.error("File save cancelled or failed:",e);return}}async readFile(){try{const[t]=await window.showOpenFilePicker({types:[{description:"File JSON",accept:{"application/json":[".json"]}}],multiple:!1});return await(await t.getFile()).text()}catch(t){return console.error("File open cancelled or failed:",t),null}}}class S{view;isVisualizing=!1;constructor(t){this.view=t,this.view.initialize()}toggleButton(){const t=this.view.getVisualizeButton();t.classList.contains("btn-start")?(t.classList.remove("btn-start"),t.classList.add("btn-stop"),t.textContent="Stop Visualizing",this.isVisualizing=!0):(t.classList.remove("btn-stop"),t.classList.add("btn-start"),t.textContent="Visualize",this.isVisualizing=!1)}buttonDisabled(t){this.view.getClearPathButton().disabled=t,this.view.getClearWallsButton().disabled=t,this.view.getClearBoardButton().disabled=t,this.view.getSaveFileButton().disabled=t,this.view.getOpenFileButton().disabled=t}handleVisualize(t,e){this.view.getVisualizeButton().addEventListener("click",async()=>{if(this.toggleButton(),this.isVisualizing){this.buttonDisabled(!0);const i=this.view.getAlgorithmSelectElement().value;await t(i),this.isVisualizing&&this.toggleButton(),this.buttonDisabled(!1)}else e()})}handleClearWalls(t){this.view.getClearWallsButton().addEventListener("click",()=>{this.isVisualizing||t()})}handleClearPath(t){this.view.getClearPathButton().addEventListener("click",()=>{this.isVisualizing||t()})}handleClearBoard(t){this.view.getClearBoardButton().addEventListener("click",()=>{this.isVisualizing||t()})}handleSaveFile(t){this.view.getSaveFileButton().addEventListener("click",async()=>{if(!this.isVisualizing){const s=t();s&&(await new f().saveFile(s),alert("File saved successfully!"))}})}handleOpenFile(t){this.view.getOpenFileButton().addEventListener("click",async()=>{if(!this.isVisualizing){const i=await new f().readFile();i&&t(i)}})}getIsVisualizing(){return this.isVisualizing}}class m{row;col;isWall=!1;isStart=!1;isEnd=!1;isVisited=!1;isPath=!1;distance=1/0;heuristic=0;previous=null;constructor(t,e){this.row=t,this.col=e}getRow(){return this.row}getCol(){return this.col}setWall(t){this.isWall=t}getIsWall(){return this.isWall}setStart(t){this.isStart=t}getIsStart(){return this.isStart}setEnd(t){this.isEnd=t}getIsEnd(){return this.isEnd}setDistance(t){this.distance=t}getDistance(){return this.distance}setHeuristic(t){this.heuristic=t}getHeuristic(){return this.heuristic}setPrevious(t){this.previous=t}getPrevious(){return this.previous}setVisited(t){this.isVisited=t}getIsVisited(){return this.isVisited}setPath(t){this.isPath=t}getIsPath(){return this.isPath}}class v{nodes;numRows;numCols;constructor(t,e){this.numRows=t,this.numCols=e,this.nodes=[],this.initializeMatrix()}initializeMatrix(){for(let t=0;t<this.numRows;t++){const e=[];for(let s=0;s<this.numCols;s++)e.push(new m(t,s));this.nodes.push(e)}}setNodes(t){this.nodes=t}getNodes(){return this.nodes}getNode(t,e){return this.nodes[t][e]}setNumRows(t){this.numRows=t}getNumRows(){return this.numRows}setNumCols(t){this.numCols=t}getNumCols(){return this.numCols}}class g{getNeighbors(t,e){const s=[[0,1],[1,0],[0,-1],[-1,0]],i=[];for(const[n,r]of s){const o=t.getRow()+n,l=t.getCol()+r;if(o>=0&&l>=0&&o<e.getNumRows()&&l<e.getNumCols()){const d=e.getNode(o,l);d.getIsWall()||i.push(d)}}return i}reconstructPath(t){const e=[];let s=t;for(;s;)e.unshift(s),s=s.getPrevious();return e}}class b extends g{findPath(t,e,s){const i=[e],n=new Set([e]),r=[];for(;i.length>0;){const o=i.shift();if(r.push(o),o===s)return{visitedNodesInOrder:r,shortestPath:this.reconstructPath(s)};for(const l of this.getNeighbors(o,t))n.has(l)||(n.add(l),l.setPrevious(o),i.push(l))}return{visitedNodesInOrder:r,shortestPath:[]}}}class I extends g{findPath(t,e,s){const i=[e],n=new Set([e]),r=[];for(;i.length>0;){const o=i.pop();if(r.push(o),o===s)return{visitedNodesInOrder:r,shortestPath:this.reconstructPath(s)};for(const l of this.getNeighbors(o,t))n.has(l)||(n.add(l),l.setPrevious(o),i.push(l))}return{visitedNodesInOrder:r,shortestPath:[]}}}class P{heap;constructor(t=[]){this.heap=t}getParentIndex(t){return Math.floor((t-1)/2)}getLeftChildIndex(t){return 2*t+1}getRightChildIndex(t){return 2*t+2}swap(t,e){[this.heap[t],this.heap[e]]=[this.heap[e],this.heap[t]]}size(){return this.heap.length}}class p extends P{comparator;constructor(t=[],e){super(t),this.comparator=e,this.buildHeap()}buildHeap(){for(let t=Math.floor(this.size()/2)-1;t>=0;t--)this.heapifyDown(t)}insert(t){this.heap.push(t),this.heapifyUp(this.size()-1)}shift(){if(this.size()===0)return null;if(this.size()===1)return this.heap.pop();const t=this.heap[0];return this.heap[0]=this.heap.pop(),this.heapifyDown(0),t}heapifyUp(t){for(;t>0;){const e=this.getParentIndex(t);if(this.comparator(this.heap[t],this.heap[e])>=0)break;this.swap(t,e),t=e}}heapifyDown(t){const e=this.size();for(;;){const s=this.getLeftChildIndex(t),i=this.getRightChildIndex(t);let n=t;if(s<e&&this.comparator(this.heap[s],this.heap[n])<0&&(n=s),i<e&&this.comparator(this.heap[i],this.heap[n])<0&&(n=i),n===t)break;this.swap(t,n),t=n}}}class E extends g{findPath(t,e,s){const i=[],n=new p([],(r,o)=>r.getDistance()-o.getDistance());e.setDistance(0);for(let r=0;r<t.getNumRows();r++)for(let o=0;o<t.getNumCols();o++)n.insert(t.getNode(r,o));for(;n.size()>0;){const r=n.shift();if(!r.getIsWall()){if(r.getDistance()===1/0)break;if(!r.getIsVisited()){if(r.setVisited(!0),i.push(r),r===s)return{visitedNodesInOrder:i,shortestPath:this.reconstructPath(s)};for(const o of this.getNeighbors(r,t)){const l=r.getDistance()+1;l<o.getDistance()&&(o.setDistance(l),o.setPrevious(r),n.insert(o))}}}}return{visitedNodesInOrder:i,shortestPath:[]}}}class z extends g{heuristic(t,e){return Math.abs(t.getRow()-e.getRow())+Math.abs(t.getCol()-e.getCol())}findPath(t,e,s){const i=[],n=new Map,r=new Map,o=new Set;n.set(e,0),r.set(e,this.heuristic(e,s));const l=new p([e],(d,h)=>(r.get(d)??1/0)-(r.get(h)??1/0));for(o.add(e);l.size()>0;){const d=l.shift();if(o.delete(d),i.push(d),d===s)return{visitedNodesInOrder:i,shortestPath:this.reconstructPath(s)};for(const h of this.getNeighbors(d,t)){if(h.getIsWall())continue;const u=(n.get(d)??1/0)+1;u<(n.get(h)??1/0)&&(h.setPrevious(d),n.set(h,u),r.set(h,u+this.heuristic(h,s)),o.has(h)?l.insert(h):(l.insert(h),o.add(h)))}}return{visitedNodesInOrder:i,shortestPath:[]}}}class V{static create(t){switch(t){case"BFS":return new b;case"DFS":return new I;case"Dijkstra":return new E;case"A*":return new z;default:throw new Error(`Thuật toán '${t}' không được hỗ trợ.`)}}}class B{model;view;startNode=null;endNode=null;isMousePressed=!1;isVisualization=!1;defaultRows=35;defaultCols=80;limitRows=100;limitCols=100;constructor(t){this.view=t,this.model=new v(this.defaultRows,this.defaultCols),this.initializeStartEndNodes({row:15,col:30},{row:15,col:50}),this.view.initialize(this.model),this.setupHandlers()}resetGrid(t,e,s,i,n){if(i>this.limitRows||n>this.limitCols)throw new Error(`Grid size exceeds limit of ${this.limitRows} rows and ${this.limitCols} columns.`);this.model=t,this.startNode=e,this.endNode=s,this.initializeStartEndNodes({row:e.getRow(),col:e.getCol()},{row:s.getRow(),col:s.getCol()}),this.view.initialize(this.model)}initializeStartEndNodes(t,e){this.startNode=this.model.getNode(t.row,t.col),this.startNode.setStart(!0),this.endNode=this.model.getNode(e.row,e.col),this.endNode.setEnd(!0)}setupHandlers(){const t=this.view.getBoardElement();t.addEventListener("mousedown",e=>this.handleMouseDown(e)),t.addEventListener("mouseenter",e=>this.handleMouseEnter(e)),t.addEventListener("mouseup",()=>this.handleMouseUp())}handleMouseDown(t){if(this.isVisualization)return;const e=t.target;if(e.tagName==="TD"){const[s,i]=e.id.split("-").map(Number),n=this.model.getNode(s,i);!n.getIsStart()&&!n.getIsEnd()&&(this.isMousePressed=!0,this.toggleWall(n,e))}}handleMouseEnter(t){if(!this.isMousePressed||this.isVisualization)return;const e=t.target;if(e.tagName==="TD"){const[s,i]=e.id.split("-").map(Number),n=this.model.getNode(s,i);!n.getIsStart()&&!n.getIsEnd()&&this.toggleWall(n,e)}}handleMouseUp(){this.isMousePressed=!1}toggleWall(t,e){const s=!t.getIsWall();t.setWall(s),this.view.updateNodeClass(e,s?c.WALL:c.UNVISITED)}async visualize(t){if(this.isVisualization||!this.startNode||!this.endNode)return;this.clearPath(),this.isVisualization=!0;const s=V.create(t).findPath(this.model,this.startNode,this.endNode);await this.animateVisitedNodes(s.visitedNodesInOrder),s.shortestPath.length>0&&await this.animateShortestPath(s.shortestPath),this.isVisualization=!1}async animateVisitedNodes(t){for(let e=0;e<t.length;e++){if(this.isVisualization===!1)return;await this.delay(10);const s=t[e];s.setVisited(!0);const i=this.view.getNodeElement(s.getRow(),s.getCol());!s.getIsStart()&&!s.getIsEnd()?this.view.updateNodeClass(i,c.VISITED):(this.view.removeNodeClass(i,c.UNVISITED),this.view.addNodeClass(i,c.VISITED)),s.setVisited(!0)}}async animateShortestPath(t){for(let e=0;e<t.length;e++){if(this.isVisualization===!1)return;await this.delay(50);const s=t[e];s.setPath(!0);const i=this.view.getNodeElement(s.getRow(),s.getCol());!s.getIsStart()&&!s.getIsEnd()?this.view.updateNodeClass(i,c.SHORTEST_PATH):(this.view.removeNodeClass(i,c.VISITED),this.view.addNodeClass(i,c.SHORTEST_PATH))}}clearWalls(){for(let t=0;t<this.model.getNumRows();t++)for(let e=0;e<this.model.getNumCols();e++){const s=this.model.getNode(t,e),i=this.view.getNodeElement(t,e);s.getIsWall()&&(s.setWall(!1),this.view.updateNodeClass(i,c.UNVISITED))}}clearPath(){for(let t=0;t<this.model.getNumRows();t++)for(let e=0;e<this.model.getNumCols();e++){const s=this.model.getNode(t,e),i=this.view.getNodeElement(t,e);s.setVisited(!1),s.setPath(!1),s.setDistance(1/0),s.setHeuristic(0),s.setPrevious(null),s.getIsWall()||(this.view.removeNodeClass(i,c.VISITED),this.view.removeNodeClass(i,c.SHORTEST_PATH),this.view.addNodeClass(i,c.UNVISITED))}}clearBoard(){this.clearWalls(),this.clearPath()}setIsVisualization(t){this.isVisualization=t}getIsVisualization(){return this.isVisualization}getModel(){return this.model}getStartNode(){return this.startNode}getEndNode(){return this.endNode}delay(t){return new Promise(e=>setTimeout(e,t))}}const y=a=>JSON.stringify(a,null,2),D=a=>{try{return JSON.parse(a)}catch(t){return console.error("Failed to parse data string:",t),null}},w=(a,t=!0)=>t?y(a):D(a);document.querySelector("#app").innerHTML=`
  <nav id="nav-container"></nav>
  <div id="grid-container"></div>
`;document.addEventListener("DOMContentLoaded",()=>{const a=new C("nav-container"),t=new S(a),e=new N("grid-container"),s=new B(e),i=()=>s.getIsVisualization(),n=r=>{const o=new m(r.row,r.col);return o.setStart(r.isStart),o.setWall(r.isWall),o.setEnd(r.isEnd),o.setVisited(r.isVisited),o.setPath(r.isPath),o.setDistance(r.distance),o.setHeuristic(r.heuristic),o};t.handleVisualize(r=>s.visualize(r),()=>s.setIsVisualization(!1)),t.handleClearWalls(()=>{i()||s.clearWalls()}),t.handleClearPath(()=>{i()||s.clearPath()}),t.handleClearBoard(()=>{i()||s.clearBoard()}),t.handleSaveFile(()=>i()?"":w({...s.getModel(),startNode:s.getStartNode(),endNode:s.getEndNode()})),t.handleOpenFile(r=>{if(i())return;const o=w(r,!1),l=new v(o.numRows,o.numCols);l.setNodes(o.nodes.map(u=>u.map(n)));const d=n(o.startNode),h=n(o.endNode);s.resetGrid(l,d,h,o.numRows,o.numCols)})});
