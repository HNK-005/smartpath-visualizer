(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();class p{navContainer;navHeader;navControls;algorithmOptions=[{value:"BFS",label:"Breadth-First Search (BFS)"},{value:"DFS",label:"Depth-First Search (DFS)"},{value:"Dijkstra",label:"Dijkstra's Algorithm"},{value:"A*",label:"A* Search Algorithm"}];constructor(t){const e=document.getElementById(t);if(!e)throw new Error(`Container with id ${t} not found`);this.navContainer=e,this.navHeader=this.initHeader(),this.navControls=this.initControls()}initialize(){this.navContainer.innerHTML="",this.navContainer.appendChild(this.navHeader),this.navContainer.appendChild(this.navControls),this.render()}initHeader(){const t=document.createElement("div");return t.classList.add("nav-header"),t}initControls(){const t=document.createElement("div");return t.classList.add("nav-controls"),t}renderHeader(){this.navHeader.innerHTML='<a href="#">SmartPath Visualizer</a>'}renderControls(){this.navControls.innerHTML=`
    <div class="algorithm">
        <label for="algorithm" class="combobox-label">Algorithm:</label>
        <select>
          ${this.algorithmOptions.map(t=>`<option value="${t.value}">${t.label}</option>`).join("")}
        </select> 
    </div>
    <div class="action">
      <button class="save-file btn btn-maze">
        Export
      </button>
      <button class="open-file btn btn-maze">
        Import
      </button>
      <button class="clear-board btn btn-clear">
        Clear Board
      </button>
      <button class="clear-walls btn btn-clear">
        Clear Walls
      </button>
      <button class="clear-path btn btn-clear">
        Clear Path
      </button>
      <button class="visualize btn btn-start">
        Visualize
      </button>
    </div>
    `}render(){this.renderHeader(),this.renderControls()}getAlgorithmOptions(){return this.algorithmOptions}getAlgorithmSelectElement(){return this.navControls.querySelector(".algorithm select")}getVisualizeButton(){return this.navControls.querySelector(".visualize")}getClearWallsButton(){return this.navControls.querySelector(".clear-walls")}getClearPathButton(){return this.navControls.querySelector(".clear-path")}getClearBoardButton(){return this.navControls.querySelector(".clear-board")}getSaveFileButton(){return this.navControls.querySelector(".save-file")}getOpenFileButton(){return this.navControls.querySelector(".open-file")}}var h=(l=>(l.START="start",l.END="end",l.WALL="wall",l.VISITED="visited",l.UNVISITED="unvisited",l.SHORTEST_PATH="shortest-path",l))(h||{});class N{gridContainer;gridBoard;constructor(t){const e=document.getElementById(t);if(!e)throw new Error(`Container with id ${t} not found`);this.gridContainer=e,this.gridBoard=this.initBoard()}initialize(t){this.gridContainer.innerHTML="",this.gridContainer.appendChild(this.gridBoard),this.render(t)}initBoard(){const t=document.createElement("table");return t.classList.add("board"),t}classNode(t){const e=[];return t.getIsStart()&&e.push("start"),t.getIsEnd()&&e.push("end"),t.getIsWall()&&e.push("wall"),t.getIsVisited()?e.push("visited"):e.push("unvisited"),t.getIsPath()&&e.push("shortest-path"),e.join(" ")}renderBoard(t){const e=document.createElement("tbody");t.getNodes().forEach((s,i)=>{const r=document.createElement("tr");s.forEach((o,n)=>{const a=document.createElement("td");a.id=`${i}-${n}`,a.className=this.classNode(o),r.appendChild(a)}),e.appendChild(r)}),this.gridBoard.innerHTML="",this.gridBoard.appendChild(e)}render(t){this.renderBoard(t)}getBoardElement(){return this.gridBoard}getNodeElement(t,e){return this.gridBoard.querySelector(`td[id="${t}-${e}"]`)}updateNodeClass(t,e){t.className="",this.addNodeClass(t,e)}addNodeClass(t,e){t.classList.add(e)}removeNodeClass(t,e){t.classList.remove(e)}}class g{async saveFile(t){try{const s=await(await window.showSaveFilePicker({suggestedName:"data.json",types:[{description:"File JSON",accept:{"application/json":[".json"]}}]})).createWritable();s.write(t),await s.close()}catch(e){console.error("File save cancelled or failed:",e);return}}async readFile(){try{const[t]=await window.showOpenFilePicker({types:[{description:"File JSON",accept:{"application/json":[".json"]}}],multiple:!1});return await(await t.getFile()).text()}catch(t){return console.error("File open cancelled or failed:",t),null}}}class C{view;isVisualizing=!1;constructor(t){this.view=t,this.view.initialize()}toggleButton(){const t=this.view.getVisualizeButton();t.classList.contains("btn-start")?(t.classList.remove("btn-start"),t.classList.add("btn-stop"),t.textContent="Stop Visualizing",this.isVisualizing=!0):(t.classList.remove("btn-stop"),t.classList.add("btn-start"),t.textContent="Visualize",this.isVisualizing=!1)}buttonDisabled(t){this.view.getClearPathButton().disabled=t,this.view.getClearWallsButton().disabled=t,this.view.getClearBoardButton().disabled=t,this.view.getSaveFileButton().disabled=t,this.view.getOpenFileButton().disabled=t}handleVisualize(t,e){this.view.getVisualizeButton().addEventListener("click",async()=>{if(this.toggleButton(),this.isVisualizing){this.buttonDisabled(!0);const i=this.view.getAlgorithmSelectElement().value;await t(i),this.isVisualizing&&this.toggleButton(),this.buttonDisabled(!1)}else e()})}handleClearWalls(t){this.view.getClearWallsButton().addEventListener("click",()=>{this.isVisualizing||t()})}handleClearPath(t){this.view.getClearPathButton().addEventListener("click",()=>{this.isVisualizing||t()})}handleClearBoard(t){this.view.getClearBoardButton().addEventListener("click",()=>{this.isVisualizing||t()})}handleSaveFile(t){this.view.getSaveFileButton().addEventListener("click",async()=>{if(!this.isVisualizing){const s=t();s&&(await new g().saveFile(s),alert("File saved successfully!"))}})}handleOpenFile(t){this.view.getOpenFileButton().addEventListener("click",async()=>{if(!this.isVisualizing){const i=await new g().readFile();i&&t(i)}})}getIsVisualizing(){return this.isVisualizing}}class v{row;col;isWall=!1;isStart=!1;isEnd=!1;isVisited=!1;isPath=!1;distance=1/0;heuristic=0;previous=null;constructor(t,e){this.row=t,this.col=e}getRow(){return this.row}getCol(){return this.col}setWall(t){this.isWall=t}getIsWall(){return this.isWall}setStart(t){this.isStart=t}getIsStart(){return this.isStart}setEnd(t){this.isEnd=t}getIsEnd(){return this.isEnd}setDistance(t){this.distance=t}getDistance(){return this.distance}setHeuristic(t){this.heuristic=t}getHeuristic(){return this.heuristic}setPrevious(t){this.previous=t}getPrevious(){return this.previous}setVisited(t){this.isVisited=t}getIsVisited(){return this.isVisited}setPath(t){this.isPath=t}getIsPath(){return this.isPath}}class w{nodes;numRows;numCols;constructor(t,e){this.numRows=t,this.numCols=e,this.nodes=[],this.initializeMatrix()}initializeMatrix(){for(let t=0;t<this.numRows;t++){const e=[];for(let s=0;s<this.numCols;s++)e.push(new v(t,s));this.nodes.push(e)}}setNodes(t){this.nodes=t}getNodes(){return this.nodes}getNode(t,e){return this.nodes[t][e]}setNumRows(t){this.numRows=t}getNumRows(){return this.numRows}setNumCols(t){this.numCols=t}getNumCols(){return this.numCols}}class u{getNeighbors(t,e){const s=[[0,1],[1,0],[0,-1],[-1,0]],i=[];for(const[r,o]of s){const n=t.getRow()+r,a=t.getCol()+o;if(n>=0&&a>=0&&n<e.getNumRows()&&a<e.getNumCols()){const d=e.getNode(n,a);d.getIsWall()||i.push(d)}}return i}reconstructPath(t){const e=[];let s=t;for(;s;)e.unshift(s),s=s.getPrevious();return e}}class S extends u{findPath(t,e,s){const i=[e],r=new Set([e]),o=[];for(;i.length>0;){const n=i.shift();if(o.push(n),n===s)return{visitedNodesInOrder:o,shortestPath:this.reconstructPath(s)};for(const a of this.getNeighbors(n,t))r.has(a)||(r.add(a),a.setPrevious(n),i.push(a))}return{visitedNodesInOrder:o,shortestPath:[]}}}class b extends u{findPath(t,e,s){const i=[e],r=new Set([e]),o=[];for(;i.length>0;){const n=i.pop();if(o.push(n),n===s)return{visitedNodesInOrder:o,shortestPath:this.reconstructPath(s)};for(const a of this.getNeighbors(n,t))r.has(a)||(r.add(a),a.setPrevious(n),i.push(a))}return{visitedNodesInOrder:o,shortestPath:[]}}}class P extends u{findPath(t,e,s){const i=[];e.setDistance(0);const r=[];for(let o=0;o<t.getNumRows();o++)for(let n=0;n<t.getNumCols();n++)r.push(t.getNode(o,n));for(;r.length>0;){r.sort((n,a)=>n.getDistance()-a.getDistance());const o=r.shift();if(!o.getIsWall()){if(o.getDistance()===1/0)break;if(i.push(o),o===s)return{visitedNodesInOrder:i,shortestPath:this.reconstructPath(s)};for(const n of this.getNeighbors(o,t)){const a=o.getDistance()+1;a<n.getDistance()&&(n.setDistance(a),n.setPrevious(o))}}}return{visitedNodesInOrder:i,shortestPath:[]}}}class E extends u{heuristic(t,e){return Math.abs(t.getRow()-e.getRow())+Math.abs(t.getCol()-e.getCol())}findPath(t,e,s){const i=[e],r=[],o=new Map([[e,0]]),n=new Map([[e,this.heuristic(e,s)]]);for(;i.length>0;){i.sort((d,c)=>(n.get(d)??1/0)-(n.get(c)??1/0));const a=i.shift();if(r.push(a),a===s)return{visitedNodesInOrder:r,shortestPath:this.reconstructPath(s)};for(const d of this.getNeighbors(a,t)){const c=(o.get(a)??1/0)+1;c<(o.get(d)??1/0)&&(d.setPrevious(a),o.set(d,c),n.set(d,c+this.heuristic(d,s)),i.includes(d)||i.push(d))}}return{visitedNodesInOrder:r,shortestPath:[]}}}class I{static create(t){switch(t){case"BFS":return new S;case"DFS":return new b;case"Dijkstra":return new P;case"A*":return new E;default:throw new Error(`Thuật toán '${t}' không được hỗ trợ.`)}}}class B{model;view;startNode=null;endNode=null;isMousePressed=!1;isVisualization=!1;defaultRows=35;defaultCols=80;limitRows=100;limitCols=100;constructor(t){this.view=t,this.model=new w(this.defaultRows,this.defaultCols),this.initializeStartEndNodes({row:15,col:30},{row:15,col:50}),this.view.initialize(this.model),this.setupHandlers()}resetGrid(t,e,s,i,r){if(i>this.limitRows||r>this.limitCols)throw new Error(`Grid size exceeds limit of ${this.limitRows} rows and ${this.limitCols} columns.`);this.model=t,this.startNode=e,this.endNode=s,this.initializeStartEndNodes({row:e.getRow(),col:e.getCol()},{row:s.getRow(),col:s.getCol()}),this.view.initialize(this.model)}initializeStartEndNodes(t,e){this.startNode=this.model.getNode(t.row,t.col),this.startNode.setStart(!0),this.endNode=this.model.getNode(e.row,e.col),this.endNode.setEnd(!0)}setupHandlers(){const t=this.view.getBoardElement();t.addEventListener("mousedown",e=>this.handleMouseDown(e)),t.addEventListener("mouseenter",e=>this.handleMouseEnter(e)),t.addEventListener("mouseup",()=>this.handleMouseUp())}handleMouseDown(t){if(this.isVisualization)return;const e=t.target;if(e.tagName==="TD"){const[s,i]=e.id.split("-").map(Number),r=this.model.getNode(s,i);!r.getIsStart()&&!r.getIsEnd()&&(this.isMousePressed=!0,this.toggleWall(r,e))}}handleMouseEnter(t){if(!this.isMousePressed||this.isVisualization)return;const e=t.target;if(e.tagName==="TD"){const[s,i]=e.id.split("-").map(Number),r=this.model.getNode(s,i);!r.getIsStart()&&!r.getIsEnd()&&this.toggleWall(r,e)}}handleMouseUp(){this.isMousePressed=!1}toggleWall(t,e){const s=!t.getIsWall();t.setWall(s),this.view.updateNodeClass(e,s?h.WALL:h.UNVISITED)}async visualize(t){if(this.isVisualization||!this.startNode||!this.endNode)return;this.clearPath(),this.isVisualization=!0;const s=I.create(t).findPath(this.model,this.startNode,this.endNode);await this.animateVisitedNodes(s.visitedNodesInOrder),s.shortestPath.length>0&&await this.animateShortestPath(s.shortestPath),this.isVisualization=!1}async animateVisitedNodes(t){for(let e=0;e<t.length;e++){if(this.isVisualization===!1)return;await this.delay(10);const s=t[e];s.setVisited(!0);const i=this.view.getNodeElement(s.getRow(),s.getCol());!s.getIsStart()&&!s.getIsEnd()?this.view.updateNodeClass(i,h.VISITED):(this.view.removeNodeClass(i,h.UNVISITED),this.view.addNodeClass(i,h.VISITED)),s.setVisited(!0)}}async animateShortestPath(t){for(let e=0;e<t.length;e++){if(this.isVisualization===!1)return;await this.delay(50);const s=t[e];s.setPath(!0);const i=this.view.getNodeElement(s.getRow(),s.getCol());!s.getIsStart()&&!s.getIsEnd()?this.view.updateNodeClass(i,h.SHORTEST_PATH):(this.view.removeNodeClass(i,h.VISITED),this.view.addNodeClass(i,h.SHORTEST_PATH))}}clearWalls(){for(let t=0;t<this.model.getNumRows();t++)for(let e=0;e<this.model.getNumCols();e++){const s=this.model.getNode(t,e),i=this.view.getNodeElement(t,e);s.getIsWall()&&(s.setWall(!1),this.view.updateNodeClass(i,h.UNVISITED))}}clearPath(){for(let t=0;t<this.model.getNumRows();t++)for(let e=0;e<this.model.getNumCols();e++){const s=this.model.getNode(t,e),i=this.view.getNodeElement(t,e);s.setVisited(!1),s.setPath(!1),s.setDistance(1/0),s.setHeuristic(0),s.setPrevious(null),s.getIsWall()||(this.view.removeNodeClass(i,h.VISITED),this.view.removeNodeClass(i,h.SHORTEST_PATH),this.view.addNodeClass(i,h.UNVISITED))}}clearBoard(){this.clearWalls(),this.clearPath()}setIsVisualization(t){this.isVisualization=t}getIsVisualization(){return this.isVisualization}getModel(){return this.model}getStartNode(){return this.startNode}getEndNode(){return this.endNode}delay(t){return new Promise(e=>setTimeout(e,t))}}const V=l=>JSON.stringify(l,null,2),z=l=>{try{return JSON.parse(l)}catch(t){return console.error("Failed to parse data string:",t),null}},f=(l,t=!0)=>t?V(l):z(l);document.querySelector("#app").innerHTML=`
  <nav id="nav-container"></nav>
  <div id="grid-container"></div>
`;document.addEventListener("DOMContentLoaded",()=>{const l=new p("nav-container"),t=new C(l),e=new N("grid-container"),s=new B(e),i=()=>s.getIsVisualization(),r=o=>{const n=new v(o.row,o.col);return n.setStart(o.isStart),n.setWall(o.isWall),n.setEnd(o.isEnd),n.setVisited(o.isVisited),n.setPath(o.isPath),n.setDistance(o.distance),n.setHeuristic(o.heuristic),n};t.handleVisualize(o=>s.visualize(o),()=>s.setIsVisualization(!1)),t.handleClearWalls(()=>{i()||s.clearWalls()}),t.handleClearPath(()=>{i()||s.clearPath()}),t.handleClearBoard(()=>{i()||s.clearBoard()}),t.handleSaveFile(()=>i()?"":f({...s.getModel(),startNode:s.getStartNode(),endNode:s.getEndNode()})),t.handleOpenFile(o=>{if(i())return;const n=f(o,!1),a=new w(n.numRows,n.numCols);a.setNodes(n.nodes.map(m=>m.map(r)));const d=r(n.startNode),c=r(n.endNode);s.resetGrid(a,d,c,n.numRows,n.numCols)})});
